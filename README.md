# Игра мафия
Данный репозиторий реализует клиент и сервер для игры в мафию на основе `gRPC`.
Также реализован сервер игрового чата на основе `RabbitMQ`.

## Сборка
Сервер игры, сервер чата и клиент собираются командой:
```
docker compose build --no-cache
```
Адрес игрового сервера передается через файл `.env`, который находится в корне репозитория.
Адрес по умолчанию `0.0.0.0:50051`.
Сервер игры подключает игроков и создает новую сессию сразу, как только набирается 4 свободных игрока.
Общение игроков происходит через сервер чата.

## Запуск
Сначала запускайте сервер `RabbitMQ`, затем сервер игры, затем сервер игрового чата, и только потом клиенты.

Запустить сервер `RabbitMQ`:
```
docker compose up rabbitmq
```
Запустить сервер игры:
```
docker compose up game_server
```
Запустить сервер игрового чата:
```
docker compose up chat_server
```
Запустить клиент (можно выполнять несколько раз, для создания множества клиентов):
```
docker compose run client
```

## Игровой процесс
На старте клиент спросит, хотите ли вы запустить его в бот режиме.
В режиме бота клиент полностью автономен, каждый раз выбирает случайные действия.
Далее будет запрошено имя, под которым данный клиент будет отображаться на сервере.
Имена могут быть не уникальными, ведь сервер выдает каждому клиенту уникальный идентификатор.
После подключения к серверу, клиент будет ожидать от вас ввода команд.
Всегда можно ввести команду `help` и увидеть cписок доступных команд.
Кроме `help` есть команды:
```
c - Переподключиться к серверу с другим именем (текущая сессия теряется).
v - Узнать доступные действия во время активной сессии игры в мафию (их также можно вводить).
a - Узнать список всех игроков на сервере.
s - Узнать состояние текущей сессии (полезная и очень информативная команда).
t <TEXT> - Отправить сообщение в чат. Например 't Hello!' отправит сообщение 'Hello!'.
exit - Выйти из клиента.
```

Если запустили клиент в бот режиме, не бойтесь убивать его, ведь сам он играть не закончит.
Сервер распознает такие ситуации и примет соответствующие действия.
Если отключаемый игрок имел статус духа, до текущая сессия не завершается, 
если же игрок не был духом, сессия завершается для всех.
Голосовать за себя можно.
Если в процессе голосования нельзя установить одного лидера, тогда никто не умирает.
Общение в игре идет через сервер чата. Пока клиент не находится в сессии, его сообщения 
адресуются таким же безсессионным игрокам. Как только клиент подключается к сессии, его 
общение начинает происходить внутри сессии согласно правилам (днем общаются все, ночью только мафия).
Духи могут читать сообщения, но не могут писать.

Приятной игры!
